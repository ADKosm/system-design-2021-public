# Домашнее Задание 2. Часть 1.

**Решения принимаются до 7 ноября включительно**

## Задача

Добавить в сервис, реализованный в первом ДЗ, возможность модификации документов 
с кешированием на основе Redis. Модификацию документов также необходимо поддержать в in-memory режиме.


К решению предъявляются все те же требования, что в [hw2-milestone1](../hw2-milestone1), 
а также несколько дополнительных:

- необходимо реализовать эндпоинт ``PATCH /api/v1/posts/{postId}``. 
  Этот эндпоинт должен поддерживаться во всех режимах работы приложения.
- необходимо поддержать значение ``cached`` переменной ``STORAGE_MODE``. В этом режиме приложение должно
  кешировать посты в Redis, адрес которого задан в переменной окружения ``REDIS_URL``.

Обновленную спецификацию OpenAPI можно найти в [microblog.yaml](./microblog.yaml).

## Рекоммендации

- если у вас в коде всё еще нет интерфейса хранилища постов, рекомендуем его создать, 
  иначе поддержать все 3 интерфейса будет непросто.

- озаботьтесь грамотной инвалидацией кэша. Если не знаете, как это сделать,
  посмотрите записи наших семинаров, посвященных этой теме.

## Формат сдачи


- Сервис должен быть оформлен в виде git-репозитория с реализацией на Go.
  В корне репозитория должен находиться ``Dockerfile``, описывающий образ сервиса.

- Репозиторий должен быть **приватным**, read-доступ к нему необходимо предоставить 3-м пользователям:
    - [hse-system-design-bot](https://github.com/hse-system-design-bot) -- без этого сборка в Jenkins не случится!
    - [ADKosm](https://github.com/ADKosm)
    - [lfyuomr-gylo](https://github.com/lfyuomr-gylo)

  **NOTE**: если вы сдавали более ранние задания, пожалуйста, используйте те же репозитории. Если вы не сдавали домашку,
  **озаботьтесь созданием репозитория заранее**, чтобы не опоздать к дедлайну из-за того,
  что hse-system-design-bot (в лице Льва) не принял инвайт, который вы отправили в 23:30 в воскресенье.
  SLA приёма инвайтов --- 24 часа.

- При запуске Docker-образа сервис должен автоматически стартовать в соответствии с установленными переменными
  окружения:

    - `SERVER_PORT` --- номер порта, на котором должен быть доступен API
    - `STORAGE_MODE` --- режим хранения постов, возможно одно из двух значений:
        - `inmemory` --- хранение в памяти (в этом режиме сервис должен себя вести так же, как в первом задании)
        - `mongo` --- хранение в MongoDB. Адрес и название базы данных передаются
          в отдельных переменных окружения (см. ниже)
        - `cached` --- хранение в MongoDB с кешированием к Redis.
          Адреса MongoDB и Redis передается в отдельной переменной окружения (см. ниже)
    - `MONGO_URL` --- адрес для подключения к MongoDB
    - `MONGO_DBNAME` --- название базы данных, которую можно использовать для хранения.
    - `REDIS_URL` --- адрес для подключения к Redis

- Критерий сдачи --- успешная сборка Jenkins-джобы http://jenkins.systemdesign.solutions/job/hw2-milestone1
  (логин `student` пароль `student1234!`)

- Успешную сборку нужно сохранить, нажав кнопку "Хранить эту сборку вечно",
  и загрузить в форму https://forms.gle/9MMiiLTsMrronHZy5
