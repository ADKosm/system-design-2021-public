# Домашнее Задание 2.

## Сроки сдачи

* Срок сдачи в качестве маленькой домашки `hw2-m1` --- до **6 ноября 23:59:59.(9) МСК** включительно
* Срок сдачи в качестве большой домашки `hw2` --- до **20 ноября 23:59:59.(9) МСК** включительно 

## Задача

Добавить в сервис, реализованный в первом ДЗ, возможность модификации документов
с кешированием на основе Redis. Модификацию документов также необходимо поддержать в in-memory режиме.


К решению предъявляются все те же требования, что в [hw1-milestone2](../02-hw1-milestone2),
а также несколько дополнительных:

- необходимо реализовать эндпоинт ``PATCH /api/v1/posts/{postId}``.
  Этот эндпоинт должен поддерживаться во всех режимах работы приложения.
- необходимо поддержать значение ``cached`` переменной ``STORAGE_MODE``. В этом режиме приложение должно
  кешировать посты в Redis, адрес которого задан в переменной окружения ``REDIS_URL``.

Обновленную спецификацию OpenAPI можно найти в [microblog.yaml](./microblog.yaml).

## Рекоммендации

- если у вас в коде всё еще нет интерфейса хранилища постов, рекомендуем его создать,
  иначе поддержать все 3 интерфейса будет непросто.

- озаботьтесь грамотной инвалидацией кэша. Если не знаете, как это сделать,
  посмотрите записи наших семинаров, посвященных этой теме.

## Формат сдачи

- Сервис должен быть оформлен в виде **приватного** git-репозитория в организации [hse-system-design](https://github.com/hse-system-design)
  с реализацией на Go. В корне репозитория должен находиться ``Dockerfile``, описывающий образ сервиса.

- При запуске Docker-образа сервис должен автоматически стартовать в соответствии с установленными переменными
  окружения:

    - `SERVER_PORT` --- номер порта, на котором должен быть доступен API
    - `STORAGE_MODE` --- режим хранения постов, возможно одно из двух значений:
        - `inmemory` --- хранение в памяти (в этом режиме сервис должен себя вести так же, как в первом задании)
        - `mongo` --- хранение в MongoDB. Адрес и название базы данных передаются
          в отдельных переменных окружения (см. ниже)
        - `cached` --- хранение в MongoDB с кешированием к Redis.
          Адреса MongoDB и Redis передается в отдельной переменной окружения (см. ниже)
    - `MONGO_URL` --- адрес для подключения к MongoDB
    - `MONGO_DBNAME` --- название базы данных, которую можно использовать для хранения.
    - `REDIS_URL` --- адрес для подключения к Redis

- Критерий сдачи --- успешная сборка Jenkins-джобы http://51.250.71.53/job/hw2-milestone1/
  (логин `student` пароль `student1234!`)

- Успешную сборку нужно сохранить, нажав кнопку "Keep this build forever"

- Опционально можно сохранить хеш коммита в форму https://forms.gle/W2gzpVqfyMM8aZGe7